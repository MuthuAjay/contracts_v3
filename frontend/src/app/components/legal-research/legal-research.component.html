<div class="contract-review-container">
    <!-- Header Section -->
    <div class="header-section">
      <button class="back-button" (click)="backToContracts()">
        <mat-icon>arrow_back</mat-icon> Back to Contracts
      </button>
      
      <h1>Legal Research: {{ fileName }}</h1>
      
      <div class="analysis-info">
        <span class="analysis-type">{{ analysisType | titlecase }}</span>
        <span class="analysis-date" *ngIf="analysisDate">Analysis Date: {{ analysisDate | date:'medium' }}</span>
      </div>

      <!-- Debug info -->
      <div *ngIf="!contractData && rawData" class="debug-info">
        <button mat-button color="warn" (click)="loadContractData()">
          <mat-icon>refresh</mat-icon> Reload Data
        </button>
        <p>Data loaded but not displayed properly. Check console for details.</p>
      </div>
    </div>
  
    <!-- Loading State -->
    <div *ngIf="isLoading" class="loading-container">
      <mat-spinner diameter="50"></mat-spinner>
      <p>Loading legal research data...</p>
    </div>
  
    <!-- Main Content -->
    <div class="content-section" *ngIf="!isLoading && contractData">
      <!-- Research Results Section -->
      <mat-card *ngIf="contractData['Research Results']" class="content-card">
        <mat-card-header>
          <mat-card-title>
            <mat-icon>gavel</mat-icon>
            Legal Research Results
          </mat-card-title>
        </mat-card-header>
        <mat-card-content>
          <div class="section-content markdown-body" [innerHTML]="contractData['Research Results']"></div>
        </mat-card-content>
      </mat-card>
  
      <!-- Dynamic additional sections -->
      <ng-container *ngFor="let section of getSections()">
        <mat-card 
          *ngIf="section !== 'Research Results'" 
          class="content-card">
          <mat-card-header>
            <mat-card-title>
              <mat-icon>article</mat-icon>
              {{ section }}
            </mat-card-title>
          </mat-card-header>
          <mat-card-content>
            <div class="section-content markdown-body" [innerHTML]="contractData[section]"></div>
          </mat-card-content>
        </mat-card>
      </ng-container>

      <!-- Raw data display as fallback -->
      <mat-card *ngIf="getSections().length === 0 && rawData?.result?.['Legal Research']" class="content-card">
        <mat-card-header>
          <mat-card-title>
            <mat-icon>code</mat-icon>
            Legal Research Data
          </mat-card-title>
        </mat-card-header>
        <mat-card-content>
          <pre class="raw-data">{{ rawData.result['Legal Research'] | json }}</pre>
        </mat-card-content>
      </mat-card>
    </div>
  
    <!-- No Data State -->
    <div *ngIf="!isLoading && !contractData" class="no-data-container">
      <mat-icon>error_outline</mat-icon>
      <p>No legal research data available</p>
      <button mat-button color="primary" (click)="backToContracts()">Return to Contracts</button>
    </div>
</div>