<div class="contract-review-container">
    <!-- Header Section -->
    <div class="header-section">
      <button class="back-button" (click)="backToContracts()">
        <mat-icon>arrow_back</mat-icon> Back to Contracts
      </button>
      
      <h1>Risk Assessment: {{ fileName }}</h1>
      
      <div class="analysis-info">
        <span class="analysis-type">{{ analysisType | titlecase }}</span>
        <span class="analysis-date" *ngIf="analysisDate">Analysis Date: {{ analysisDate | date:'medium' }}</span>
      </div>
      
      <!-- Debug info -->
      <div *ngIf="!contractData && rawData" class="debug-info">
        <button mat-button color="warn" (click)="loadContractData()">
          <mat-icon>refresh</mat-icon> Reload Data
        </button>
        <p>Data loaded but not displayed properly. Check console for details.</p>
      </div>

      <!-- Category Tabs -->
      <div class="navigation-tabs" *ngIf="!isLoading && contractData">
        <button 
          *ngFor="let category of getCategories()" 
          [class.active]="currentSection === category"
          (click)="changeSection(category)">
          <mat-icon>{{ getCategoryIcon(category) }}</mat-icon>
          {{ category === 'all' ? 'All Risks' : (category | titlecase) }}
        </button>
      </div>
    </div>
  
    <!-- Loading State -->
    <div *ngIf="isLoading" class="loading-container">
      <mat-spinner diameter="50"></mat-spinner>
      <p>Loading risk assessment data...</p>
    </div>
  
    <!-- Main Content -->
    <div class="content-section" *ngIf="!isLoading && contractData">
      <!-- Legal Risks Section -->
      <mat-card *ngIf="shouldShowSection('legal') && contractData['legal']" class="content-card risk-card" [ngClass]="'risk-' + getRiskLevel('legal')">
        <mat-card-header>
          <mat-card-title>
            <mat-icon>gavel</mat-icon>
            Legal Risks
          </mat-card-title>
        </mat-card-header>
        <mat-card-content>
          <div class="section-content markdown-body" [innerHTML]="contractData['legal']"></div>
        </mat-card-content>
      </mat-card>
  
      <!-- Financial Risks Section -->
      <mat-card *ngIf="shouldShowSection('financial') && contractData['financial']" class="content-card risk-card" [ngClass]="'risk-' + getRiskLevel('financial')">
        <mat-card-header>
          <mat-card-title>
            <mat-icon>attach_money</mat-icon>
            Financial Risks
          </mat-card-title>
        </mat-card-header>
        <mat-card-content>
          <div class="section-content markdown-body" [innerHTML]="contractData['financial']"></div>
        </mat-card-content>
      </mat-card>
  
      <!-- Operational Risks Section -->
      <mat-card *ngIf="shouldShowSection('operational') && contractData['operational']" class="content-card risk-card" [ngClass]="'risk-' + getRiskLevel('operational')">
        <mat-card-header>
          <mat-card-title>
            <mat-icon>build</mat-icon>
            Operational Risks
          </mat-card-title>
        </mat-card-header>
        <mat-card-content>
          <div class="section-content markdown-body" [innerHTML]="contractData['operational']"></div>
        </mat-card-content>
      </mat-card>
  
      <!-- Compliance Risks Section -->
      <mat-card *ngIf="shouldShowSection('compliance') && contractData['compliance']" class="content-card risk-card" [ngClass]="'risk-' + getRiskLevel('compliance')">
        <mat-card-header>
          <mat-card-title>
            <mat-icon>verified_user</mat-icon>
            Compliance Risks
          </mat-card-title>
        </mat-card-header>
        <mat-card-content>
          <div class="section-content markdown-body" [innerHTML]="contractData['compliance']"></div>
        </mat-card-content>
      </mat-card>
      
      <!-- Dynamic additional sections -->
      <ng-container *ngFor="let section of getSections()">
        <mat-card 
          *ngIf="!['legal', 'financial', 'operational', 'compliance', 'Raw Data'].includes(section) && 
                 shouldShowSection(section)" 
          class="content-card risk-card" 
          [ngClass]="'risk-' + getRiskLevel(section)">
          <mat-card-header>
            <mat-card-title>
              <mat-icon>assessment</mat-icon>
              {{ section | titlecase }} Risks
            </mat-card-title>
          </mat-card-header>
          <mat-card-content>
            <div class="section-content markdown-body" [innerHTML]="contractData[section]"></div>
          </mat-card-content>
        </mat-card>
      </ng-container>

      <!-- No risks message when filtering shows nothing -->
      <div *ngIf="currentSection !== 'all' && !contractData[currentSection]" class="no-risks-container">
        <mat-icon>info</mat-icon>
        <p>No {{ currentSection | titlecase }} risks found in this assessment.</p>
      </div>

      <!-- Raw data display as fallback -->
      <mat-card *ngIf="getSections().length === 0 && contractData['Raw Data']" class="content-card">
        <mat-card-header>
          <mat-card-title>
            <mat-icon>code</mat-icon>
            Risk Assessment Data
          </mat-card-title>
        </mat-card-header>
        <mat-card-content>
          <pre class="raw-data">{{ contractData['Raw Data'] | json }}</pre>
        </mat-card-content>
      </mat-card>
    </div>
  
    <!-- No Data State -->
    <div *ngIf="!isLoading && !contractData" class="no-data-container">
      <mat-icon>error_outline</mat-icon>
      <p>No risk assessment data available</p>
      <button mat-button color="primary" (click)="backToContracts()">Return to Contracts</button>
    </div>
</div>